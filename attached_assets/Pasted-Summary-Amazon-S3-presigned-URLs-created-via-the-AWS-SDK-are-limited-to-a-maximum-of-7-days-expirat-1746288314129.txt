Summary

Amazon S3 presigned URLs created via the AWS SDK are limited to a maximum of 7 days expiration (and only 12 hours if using temporary STS credentials)  ￼ ￼. To expose audio links valid for 90 days without a Cloudflare Worker, you can implement a simple server-side proxy endpoint on your Replit-hosted Express app that, on each request, generates a fresh short-lived R2 signed URL and issues an HTTP redirect  ￼. By embedding your own /media/:key URL in the PDF, the link itself never expires for 90 days—each click behind the scenes renews the signature.

Implementation
	1.	Add a proxy route to your Express server (e.g. in uploadController or a separate router):

import express from 'express';
import { getSignedR2Url } from './r2Storage';

const router = express.Router();

// Proxy endpoint for media keys
router.get('/media/:key', async (req, res) => {
  const { key } = req.params;
  try {
    // Generate a short-lived signed URL (e.g. 1 hour)
    const signedUrl = await getSignedR2Url(key, 60 * 60);
    // Redirect the client to the actual R2 URL
    return res.redirect(signedUrl);
  } catch (error) {
    console.error('Failed to sign R2 URL for key:', key, error);
    return res.status(500).send('Error generating signed URL');
  }
});

export default router;


	2.	Mount the router in your main server file:

import mediaRouter from './path/to/mediaRouter';
app.use('/', mediaRouter);


	3.	Embed the proxy link in your PDF generation instead of the raw presigned URL:

// Where `message.mediaKey` is the R2 object key you stored (e.g. returned by uploadMediaToR2)
const proxyUrl = `${process.env.APP_BASE_URL}/media/${encodeURIComponent(message.mediaKey)}`;
// Use proxyUrl when creating your PDF link annotation


	4.	Result:
	•	The PDF’s hyperlinks point to your own server (/media/:key), which never expires for 90 days as long as your app runs.
	•	Each download request triggers a fresh AWS-signed URL (valid up to 7 days) generated at runtime.

This keeps your deployment on Replit simple—no external workers or additional infrastructure—while providing 90-day access to the audio files behind the scenes.